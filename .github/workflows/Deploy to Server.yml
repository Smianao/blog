name: Deploy to Server

on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      # æ­¥éª¤1: è·å–ä»“åº“ä»£ç 
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # æ­¥éª¤2: è®¾ç½® Node.js ç¯å¢ƒï¼ˆä¿®æ­£äº†å·¥ä½œç›®å½•å‚æ•°ä½ç½®ï¼‰ âš ï¸
      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20  # VuePress æ¨èä½¿ç”¨ Node 16/18/20 ç‰ˆæœ¬ï¼ˆ22å¯èƒ½æœ‰å…¼å®¹é—®é¢˜ï¼‰
          cache: npm
        working-directory: ./src  # æ­£ç¡®çš„å‚æ•°å±‚çº§

      # æ­¥éª¤3: å®‰è£…ä¾èµ–ï¼ˆæ·»åŠ å·¥ä½œç›®å½•å‚æ•°ï¼‰ âš ï¸
      - name: å®‰è£…ä¾èµ–
        run: npm ci
        working-directory: ./src  # å¿…è¦çš„å·¥ä½œç›®å½•æŒ‡å®š

      # æ­¥éª¤4: æ„å»ºé¡¹ç›®ï¼ˆæ·»åŠ å·¥ä½œç›®å½•å‚æ•°ï¼‰ âš ï¸
      - name: æ„å»º VuePress ç«™ç‚¹
        run: npm run docs:build
        working-directory: ./src

      # æ­¥éª¤5: ä¸Šä¼ äº§ç‰©ï¼ˆä¿®å¤ç¼©è¿›é”™è¯¯ï¼‰ ğŸ”¥æ ¸å¿ƒé”™è¯¯ç‚¹ğŸ”¥
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: src/.vuepress/dist  # ç¡®ä¿ä¸çœŸå®æ„å»ºè·¯å¾„åŒ¹é…
