name: Deploy to Server

on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      # 步骤1: 获取仓库代码
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 步骤2: 设置 Node.js 环境（修正了工作目录参数位置） ⚠️
      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20  # VuePress 推荐使用 Node 16/18/20 版本（22可能有兼容问题）
          cache: npm
        working-directory: ./src  # 正确的参数层级

      # 步骤3: 安装依赖（添加工作目录参数） ⚠️
      - name: 安装依赖
        run: npm ci
        working-directory: ./src  # 必要的工作目录指定

      # 步骤4: 构建项目（添加工作目录参数） ⚠️
      - name: 构建 VuePress 站点
        run: npm run docs:build
        working-directory: ./src

      # 步骤5: 上传产物（修复缩进错误） 🔥核心错误点🔥
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: src/.vuepress/dist  # 确保与真实构建路径匹配
